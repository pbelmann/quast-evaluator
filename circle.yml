machine:
  environment:
    PATH: ${HOME}/R/bin:${PATH}
  services:
    - docker

dependencies:
  cache_directories:
    - "~/R"

  pre:
    - sudo apt-get update && sudo apt-get install -y wget
    - mkdir $HOME/R
    - wget http://cran.rstudio.com/src/base/R-3/R-3.2.4.tar.gz
    - tar xvf R-3.2.4.tar.gz
    - cd R-3.2.4  && ./configure --prefix=$HOME/R  && make && make install
    - cd $HOME/$CIRCLE_PROJECT_REPONAME && sudo apt-get install -y r-base r-recommended libicu52 libcurl4-openssl-dev pandoc && R -e 'options(download.file.method = "wget"); install.packages("packrat" , repos="http://cran.us.r-project.org"); packrat::restore()'
    - docker build -t quast-evaluator  .

test:
  override:
    - cd $HOME/$CIRCLE_PROJECT_REPONAME && R -e 'devtools::test()' 
